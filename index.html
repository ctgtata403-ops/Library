<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ü‡¶Ø‡¶º ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶™‡ßç‡¶∞‡ßã</title>
    <link href="https://fonts.googleapis.com/css2?family=Anek+Bangla:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { font-family: 'Anek Bangla', sans-serif !important; }

        :root { 
            --primary: #2196F3; --income: #4CAF50; --expense: #F44336; 
            --bg: #F8F9FA; --card-bg: #ffffff; --text: #333333; --border: #eeeeee;
        }

        body.dark-mode {
            --bg: #121212; --card-bg: #1e1e1e; --text: #e0e0e0; --border: #333333;
        }

        body { background: var(--bg); color: var(--text); margin: 0; padding: 0; transition: 0.3s; overflow-x: hidden; }

        /* --- ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® --- */
        #loader-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #2196F3; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
            transition: opacity 0.4s ease; padding: 30px; text-align: center; box-sizing: border-box;
        }
        .simple-spinner {
            width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.2);
            border-top: 4px solid white; border-radius: 50%;
            animation: spin 0.8s linear infinite; margin-bottom: 20px;
        }
        #quote-text { color: white; font-size: 19px; font-weight: 600; margin-bottom: 8px; line-height: 1.5; }
        #quote-ref { color: rgba(255,255,255,0.8); font-size: 14px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- ‡¶Æ‡ßá‡¶á‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ --- */
        .app-container { width: 100%; max-width: 450px; background: var(--card-bg); min-height: 100vh; margin: auto; position: relative; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        header { padding: 15px 20px; background: var(--card-bg); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .logo-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .logo { color: var(--primary); font-size: 22px; font-weight: 800; }
        #searchInput { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px; background: var(--bg); color: var(--text); box-sizing: border-box; outline: none; }

        .period-box { background: var(--bg); padding: 5px; border-radius: 12px; display: flex; border: 1px solid var(--border); margin: 15px 20px; }
        .period-btn { flex: 1; padding: 10px; border: none; background: transparent; font-weight: 700; cursor: pointer; border-radius: 8px; color: var(--text); }
        .period-btn.active { background: var(--primary); color: #fff; }

        .summary-card { margin: 10px 15px; padding: 18px; border-radius: 18px; border: 1px solid var(--border); display: grid; grid-template-columns: 1fr 1fr 1fr; text-align: center; }
        .summary-item p { margin: 6px 0 0; font-weight: 800; font-size: 15px; }

        .cat-chip { padding: 8px 18px; background: var(--bg); border-radius: 25px; font-size: 14px; white-space: nowrap; cursor: pointer; border: 1px solid var(--border); font-weight: 600; }
        .cat-chip.active { background: var(--primary); color: #fff; border-color: var(--primary); }

        .item { padding: 15px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .item-actions { display: flex; gap: 15px; align-items: center; }
        .action-btn { cursor: pointer; font-size: 18px; opacity: 0.7; }

        .fab { position: fixed; bottom: 30px; right: 20px; width: 60px; height: 60px; background: var(--primary); color: #fff; border-radius: 50%; border: none; font-size: 35px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); cursor: pointer; z-index: 90; }

        /* --- ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® --- */
        .screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--card-bg); z-index: 1000; overflow-y: auto; }
        .screen-header { padding: 15px 20px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid var(--border); background: var(--card-bg); position: sticky; top: 0; }
        .profile-card { background: var(--bg); margin: 20px; padding: 25px; border-radius: 20px; border: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; text-align: center; }
        .profile-img { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; margin-bottom: 15px; }
        
        /* ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .settings-card { background: var(--bg); margin: 10px 20px; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid var(--border); }
        .download-btn { background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 10px; font-size: 14px; flex: 1; }

        .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 18px 20px; border-bottom: 1px solid var(--border); cursor: pointer; text-decoration: none; color: inherit; }
        .switch { position: relative; display: inline-block; width: 45px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(21px); }

        /* --- ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤/‡¶™‡¶™‡¶Ü‡¶™ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® (‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã) --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1100; }
        .modal-content { background: var(--card-bg); width: 85%; max-width: 350px; margin: 80px auto; border-radius: 20px; padding: 25px; color: var(--text); }
        .type-toggle { display: flex; background: var(--bg); border-radius: 10px; padding: 4px; margin-bottom: 20px; }
        .type-btn { flex: 1; padding: 10px; text-align: center; cursor: pointer; border-radius: 8px; font-weight: 700; color: #888; }
        .active-inc { background: var(--income) !important; color: white !important; }
        .active-exp { background: var(--expense) !important; color: white !important; }
        input, select { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); box-sizing: border-box; }
        .btn-save { width: 100%; padding: 12px; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body>

<div id="loader-wrapper">
    <div class="simple-spinner"></div>
    <div id="quote-text">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
    <div id="quote-ref"></div>
</div>

<div class="app-container">
    <header>
        <div class="logo-row">
            <div class="logo">‚ö° ‡¶Ü‡¶Ø‡¶º ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶™‡ßç‡¶∞‡ßã</div>
            <div style="display:flex; gap:20px">
                <span onclick="openCatScreen()" style="cursor:pointer; font-size: 22px;">üìÅ</span>
                <span onclick="openSettings()" style="cursor:pointer; font-size: 22px;">‚öôÔ∏è</span>
            </div>
        </div>
        <input type="text" id="searchInput" placeholder="‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." oninput="renderMain()">
    </header>

    <div class="period-box">
        <button id="btn-month" class="period-btn active" onclick="setPeriod('month')">‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏</button>
        <button id="btn-all" class="period-btn" onclick="setPeriod('all')">‡¶Æ‡ßã‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</button>
    </div>

    <div class="summary-card">
        <div class="summary-item"><h4>‡¶Ü‡¶Ø‡¶º</h4><p style="color:var(--income)">‡ß≥ <span id="top-inc">‡ß¶</span></p></div>
        <div class="summary-item"><h4>‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</h4><p style="color:var(--expense)">‡ß≥ <span id="top-exp">‡ß¶</span></p></div>
        <div class="summary-item"><h4>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</h4><p id="top-bal" style="color:var(--primary)">‡ß≥ ‡ß¶</p></div>
    </div>

    <div style="display: flex; overflow-x: auto; gap: 8px; padding: 10px 20px;" id="cat-chips"></div>
    <div style="padding: 0 15px 100px;" id="main-list"></div>
    <button class="fab" onclick="openAddModal()">+</button>
</div>

<div id="settingsScreen" class="screen">
    <div class="screen-header"><span onclick="closeSettings()" style="cursor:pointer; font-size: 24px;">‚Üê</span><strong>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</strong></div>
    <div class="profile-card">
        <img src="https://maruf.lovestoblog.com/wp-content/uploads/2026/01/1000102487-edited-768x768.jpg" alt="Maruf" class="profile-img">
        <h2 class="profile-name" style="margin: 5px 0;">‡¶Æ‡¶ú‡ßÅ‡¶Æ‡¶¶‡¶æ‡¶∞ ‡¶Æ‡ßã. ‡¶Æ‡¶æ‡¶∞‡ßÅ‡¶´</h2>
        <div style="color: #666; font-size: 14px;">‡¶∞‡ßá‡¶°‡¶ø‡¶ì‡¶ó‡ßç‡¶∞‡¶æ‡¶´‡¶ø, ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶¨‡¶∞‡ßç‡¶∑<br>‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞‡¶ø ‡¶Ü‡¶á‡¶è‡¶ö‡¶ü‡¶ø</div>
    </div>

    <div class="settings-card">
        <div style="color: var(--primary); font-size: 14px; font-weight: 700;">üìä ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</div>
        <div style="display: flex; gap: 10px; padding: 5px;">
            <button class="download-btn" onclick="downloadReport('month')">üìÖ ‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏</button>
            <button class="download-btn" style="background:#607D8B" onclick="downloadReport('all')">üóìÔ∏è ‡¶Æ‡ßã‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</button>
        </div>
    </div>

    <div class="setting-row">
        <div style="display:flex; align-items:center; gap:15px; font-weight:600;"><span>üåô</span> <span>‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶°</span></div>
        <label class="switch"><input type="checkbox" id="darkModeToggle" onclick="toggleDarkMode()"><span class="slider"></span></label>
    </div>
    
    <a href="https://www.facebook.com/mazumder.md.maruf" target="_blank" class="setting-row">
        <div style="display:flex; align-items:center; gap:15px; font-weight:600;"><span>üì±</span> <span>‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶æ‡¶∞ ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï</span></div><span>üîó</span>
    </a>
</div>

<div class="modal" id="addModal">
    <div class="modal-content">
        <h3 id="modal-title" style="margin:0 0 20px; text-align:center; font-weight:800;">‡¶®‡¶§‡ßÅ‡¶® ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h3>
        <div class="type-toggle">
            <div id="toggle-inc" class="type-btn" onclick="setAddType('income')">‡¶Ü‡¶Ø‡¶º</div>
            <div id="toggle-exp" class="type-btn active-exp" onclick="setAddType('expense')">‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</div>
        </div>
        <select id="modal-cat"></select>
        <input type="number" id="modal-amount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)">
        <input type="text" id="modal-note" placeholder="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
        <button id="btn-save-transaction" class="btn-save" onclick="saveTransaction()">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <p onclick="closeModal()" style="text-align:center; color:#888; cursor:pointer; margin-top:15px; font-weight:600;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</p>
    </div>
</div>

<div id="catScreen" class="screen">
    <div class="screen-header"><span onclick="closeCatScreen()" style="cursor:pointer; font-size: 24px;">‚Üê</span><strong>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</strong></div>
    <div style="padding: 20px;"><input type="text" id="newCatInput" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø..."><button class="btn-save" onclick="addCategory()">‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button><div id="cat-list-container" style="margin-top:20px;"></div></div>
</div>

<script>
    let db = { transactions: [], categories: ['‡¶∏‡¶¨', '‡¶®‡¶æ‡¶∏‡ßç‡¶§‡¶æ', '‡¶¨‡ßá‡¶§‡¶®', '‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞', '‡¶≠‡¶æ‡ßú‡¶æ'], darkMode: false };
    try { const saved = localStorage.getItem('aybey_pro_v24'); if(saved) db = JSON.parse(saved); } catch(e) {}
    
    let activePeriod = 'month', activeCat = '‡¶∏‡¶¨', currentAddType = 'expense', editIndex = null;

    const islamicQuotes = [
        { text: "‚Äú‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡ßü‡¶á ‡¶Ö‡¶™‡¶¨‡ßç‡¶Ø‡ßü‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞‡¶æ ‡¶∂‡ßü‡¶§‡¶æ‡¶®‡ßá‡¶∞ ‡¶≠‡¶æ‡¶á‡•§‚Äù", ref: "‚Äî ‡¶∏‡ßÇ‡¶∞‡¶æ ‡¶Ü‡¶≤-‡¶á‡¶∏‡¶∞‡¶æ, ‡¶Ü‡ßü‡¶æ‡¶§: ‡ß®‡ß≠" },
        { text: "‚Äú‡¶§‡ßã‡¶Æ‡¶∞‡¶æ ‡¶ñ‡¶æ‡¶ì ‡¶ì ‡¶™‡¶æ‡¶® ‡¶ï‡¶∞‡ßã, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶Ö‡¶™‡¶ö‡ßü ‡¶ï‡¶∞‡ßã ‡¶®‡¶æ‡•§‚Äù", ref: "‚Äî ‡¶∏‡ßÇ‡¶∞‡¶æ ‡¶Ü‡¶≤-‡¶Ü‡¶∞‡¶æ‡¶´, ‡¶Ü‡ßü‡¶æ‡¶§: ‡ß©‡ßß" },
        { text: "‚Äú‡¶Æ‡¶ø‡¶§‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º‡ßÄ ‡¶π‡¶ì‡ßü‡¶æ ‡¶¨‡ßÅ‡¶¶‡ßç‡¶ß‡¶ø‡¶Æ‡¶§‡ßç‡¶§‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶ß‡ßá‡¶ï‡•§‚Äù", ref: "‚Äî ‡¶Æ‡¶ø‡¶∂‡¶ï‡¶æ‡¶§‡ßÅ‡¶≤ ‡¶Æ‡¶æ‡¶∏‡¶æ‡¶¨‡¶ø‡¶π, ‡ß´‡ß®‡ß®‡ß¨" },
        { text: "‚Äú‡¶Ø‡ßá ‡¶Æ‡¶ø‡¶§‡¶¨‡ßç‡¶Ø‡ßü‡ßÄ ‡¶π‡ßü, ‡¶∏‡ßá ‡¶ï‡¶ñ‡¶®‡ßã ‡¶®‡¶ø‡¶É‡¶∏‡ßç‡¶¨ ‡¶π‡ßü ‡¶®‡¶æ‡•§‚Äù", ref: "‚Äî ‡¶Æ‡ßÅ‡¶∏‡¶®‡¶æ‡¶¶‡ßá ‡¶Ü‡¶π‡¶Æ‡¶æ‡¶¶, ‡ß™‡ß®‡ß¨‡ßØ" },
        { text: "‚Äú‡¶∏‡¶Æ‡ßç‡¶™‡¶¶ ‡¶ï‡ßã‡¶® ‡¶™‡¶•‡ßá ‡¶Ü‡ßü ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßç‡¶Ø‡ßü ‡¶ï‡¶∞‡ßá‡¶õ‡ßã‚Äî ‡¶§‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§‚Äù", ref: "‚Äî ‡¶§‡¶ø‡¶∞‡¶Æ‡¶ø‡¶Ø‡ßÄ, ‡ß®‡ß™‡ßß‡ß¨" }
    ];

    function showRandomQuote() {
        const item = islamicQuotes[Math.floor(Math.random() * islamicQuotes.length)];
        document.getElementById('quote-text').innerText = item.text;
        document.getElementById('quote-ref').innerText = item.ref;
    }

    window.onload = function() {
        showRandomQuote();
        setTimeout(hideLoader, 2000); 
    };

    function showLoader() { 
        showRandomQuote();
        const l = document.getElementById('loader-wrapper');
        l.style.display = 'flex'; l.style.opacity = '1'; 
    }

    function hideLoader() { 
        const l = document.getElementById('loader-wrapper');
        l.style.opacity = '0'; 
        setTimeout(() => l.style.display = 'none', 400); 
    }

    function toggleDarkMode() { db.darkMode = document.getElementById('darkModeToggle').checked; applyDarkMode(); saveData(); }
    function applyDarkMode() {
        if(db.darkMode) { document.body.classList.add('dark-mode'); document.getElementById('darkModeToggle').checked = true; } 
        else { document.body.classList.remove('dark-mode'); document.getElementById('darkModeToggle').checked = false; }
    }

    function openSettings() { document.getElementById('settingsScreen').style.display = 'block'; }
    function closeSettings() { document.getElementById('settingsScreen').style.display = 'none'; }
    function openCatScreen() { document.getElementById('catScreen').style.display = 'block'; renderCatList(); }
    function closeCatScreen() { document.getElementById('catScreen').style.display = 'none'; }
    
    function openAddModal(index = null) { 
        editIndex = index;
        document.getElementById('modal-cat').innerHTML = db.categories.filter(c => c !== '‡¶∏‡¶¨').map(c => `<option value="${c}">${c}</option>`).join('');
        if (index !== null) {
            const t = db.transactions[index];
            document.getElementById('modal-amount').value = t.amount;
            document.getElementById('modal-note').value = t.note;
            document.getElementById('modal-cat').value = t.cat;
            setAddType(t.type);
            document.getElementById('modal-title').innerText = "‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®";
        } else {
            document.getElementById('modal-amount').value = '';
            document.getElementById('modal-note').value = '';
            document.getElementById('modal-title').innerText = "‡¶®‡¶§‡ßÅ‡¶® ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨";
            setAddType('expense');
        }
        document.getElementById('addModal').style.display = 'block'; 
    }

    function closeModal() { document.getElementById('addModal').style.display = 'none'; editIndex = null; }

    function setAddType(type) {
        currentAddType = type;
        document.getElementById('toggle-inc').className = type === 'income' ? 'type-btn active-inc' : 'type-btn';
        document.getElementById('toggle-exp').className = type === 'expense' ? 'type-btn active-exp' : 'type-btn';
    }

    function saveTransaction() {
        const amt = parseFloat(document.getElementById('modal-amount').value); if(!amt) return;
        showLoader();
        setTimeout(() => {
            const note = document.getElementById('modal-note').value || (currentAddType==='income'?'‡¶Ü‡ßü':'‡¶¨‡ßç‡¶Ø‡ßü');
            const cat = document.getElementById('modal-cat').value;
            if (editIndex !== null) db.transactions[editIndex] = { ...db.transactions[editIndex], type: currentAddType, cat, amount: amt, note };
            else db.transactions.unshift({ type: currentAddType, cat, amount: amt, note, date: new Date().toISOString() });
            saveData(); closeModal(); renderMain(); hideLoader();
        }, 500);
    }

    function deleteTransaction(index) {
        if(confirm("‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
            db.transactions.splice(index, 1);
            saveData(); renderMain();
        }
    }

    function downloadReport(period) {
        showLoader();
        setTimeout(() => {
            const now = new Date();
            const filtered = db.transactions.filter(t => {
                const d = new Date(t.date);
                return period === 'all' || (d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear());
            });
            if(filtered.length === 0) { alert("‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á!"); hideLoader(); return; }
            const data = filtered.map(t => ({ '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ': new Date(t.date).toLocaleDateString('bn-BD'), '‡¶¨‡¶ø‡¶¨‡¶∞‡¶£': t.note, '‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø': t.cat, '‡¶ß‡¶∞‡¶£': t.type === 'income' ? '‡¶Ü‡¶Ø‡¶º' : '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º', '‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£': t.amount }));
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "‡¶π‡¶ø‡¶∏‡¶æ‡¶¨");
            XLSX.writeFile(wb, `Hisab_Report_${period}.xlsx`);
            hideLoader();
        }, 1000);
    }

    function addCategory() {
        const val = document.getElementById('newCatInput').value.trim();
        if(val && !db.categories.includes(val)) { db.categories.push(val); saveData(); renderCatList(); renderCats(); document.getElementById('newCatInput').value = ''; }
    }
    function renderCatList() { document.getElementById('cat-list-container').innerHTML = db.categories.filter(c => c !== '‡¶∏‡¶¨').map(c => `<div style="display:flex; justify-content:space-between; padding:15px; border-bottom:1px solid var(--border);"><span>${c}</span><span onclick="deleteCat('${c}')" style="color:red; cursor:pointer">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</span></div>`).join(''); }
    function deleteCat(c) { db.categories = db.categories.filter(cat => cat !== c); saveData(); renderCatList(); renderCats(); }
    function saveData() { localStorage.setItem('aybey_pro_v24', JSON.stringify(db)); }
    function setPeriod(p) { activePeriod = p; document.getElementById('btn-month').classList.toggle('active', p === 'month'); document.getElementById('btn-all').classList.toggle('active', p === 'all'); renderMain(); }
    function renderCats() { document.getElementById('cat-chips').innerHTML = db.categories.map(c => `<div class="cat-chip ${activeCat === c ? 'active' : ''}" onclick="activeCat='${c}';renderCats();renderMain();">${c}</div>`).join(''); }

    function renderMain() {
        const list = document.getElementById('main-list'); const search = document.getElementById('searchInput').value.toLowerCase();
        list.innerHTML = ''; let inc = 0, exp = 0; const now = new Date();
        db.transactions.forEach((t, index) => {
            const d = new Date(t.date);
            const isThisMonth = (d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear());
            if ((t.note.toLowerCase().includes(search) || t.cat.toLowerCase().includes(search)) && (activeCat === '‡¶∏‡¶¨' || t.cat === activeCat) && (activePeriod === 'all' || isThisMonth)) {
                if(t.type === 'income') inc += t.amount; else exp += t.amount;
                list.innerHTML += `<div class="item"><div><strong>${t.note}</strong><br><small style="color:#888">${t.cat} ‚Ä¢ ${d.toLocaleDateString('bn-BD')}</small></div><div class="item-actions"><span style="color:${t.type==='income'?'var(--income)':'var(--expense)'}; font-weight:800">${t.type==='income'?'+':'-'} ‡ß≥${t.amount.toLocaleString('bn-BD')}</span><span class="action-btn" onclick="openAddModal(${index})">‚úèÔ∏è</span><span class="action-btn" onclick="deleteTransaction(${index})">üóëÔ∏è</span></div></div>`;
            }
        });
        document.getElementById('top-inc').innerText = inc.toLocaleString('bn-BD'); 
        document.getElementById('top-exp').innerText = exp.toLocaleString('bn-BD');
        document.getElementById('top-bal').innerText = '‡ß≥ ' + (inc - exp).toLocaleString('bn-BD');
    }

    applyDarkMode(); renderCats(); renderMain();
</script>
</body>
</html>
